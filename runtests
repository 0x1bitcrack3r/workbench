echo
echo '<<< Starting workbench server >>>'
echo
# Launch workbench server in the background
cd server
nosetests workbench &>/dev/null &
# Get its PID
workbench_pid=$!

echo
echo '<<< Running worker tests >>>'
echo
cd ../workers
./runtests

echo
echo '<<< Running client tests >>>'
echo
cd ../clients
./runtests
cd ..

echo '<<< Sending SIGINT to Worbench Server >>>'
kill -SIGINT $workbench_pid

echo '<<< Collecting coverage files >>>'
mv workers/.coverage .coverage.workers
mv clients/.coverage .coverage.clients
mv server/.coverage .coverage.server
coverage combine
